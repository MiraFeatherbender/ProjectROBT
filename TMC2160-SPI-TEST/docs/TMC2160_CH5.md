# TMC2160 Datasheet Chapter 5: Register Mapping

This chapter gives an overview of the complete register set. Some of the registers bundling a number of single bits are detailed in extra tables. The functional practical application of the settings is detailed in dedicated chapters.

**Note:**

- All registers become reset to 0 upon power up, unless otherwise noted.
- Add 0x80 to the address Addr for write accesses!

## Notation

- Hexadecimal numbers: `0x` (e.g., `0x04`)
- Multi-bit binary numbers: `%` (e.g., `%100`)
- R/W field:
  - `R`: Read only
  - `W`: Write only
  - `R/W`: Read and writable register
  - `R+C`: Clear upon read

---

## Overview Register Mapping

| REGISTER | DESCRIPTION |
|----------|------------|
| General Configuration Registers | These registers contain global configuration, global status flags, interface configuration, and I/O signal configuration |
| Velocity Dependent Driver Feature Control Register Set | This register set offers registers for driver current control, setting thresholds for coolStep operation, setting thresholds for different chopper modes, setting thresholds for dcStep operation |
| Motor Driver Register Set | This register set offers registers for setting/reading out microstep table and counter, chopper and driver configuration, coolStep and stallGuard2 configuration, dcStep configuration, reading out stallGuard2 values and driver error flags |

---

## 5.1 General Configuration Registers

### GENERAL CONFIGURATION REGISTERS (0X00…0X0F)

#### `GCONF` (Global Configuration Flags, Addr: 0x00, RW)

| Bit | Field Name                | Value/Logic | Description                                                                                                                        | Hint/Default |
|-----|---------------------------|-------------|------------------------------------------------------------------------------------------------------------------------------------|--------------|
| 0   | `recalibrate`             | 1           | Zero crossing recalibration during driver disable (via `ENN` or via `TOFF` setting)                                                |              |
| 1   | `faststandstill`          | 1           | Timeout for step execution until standstill detection: Short time: $2^{18}$ clocks                                                 |              |
|     |                           | 0           | Normal time: $2^{20}$ clocks                                                                                                       |              |
| 2   | `en_pwm_mode`             | 1           | `stealthChop` voltage PWM mode enabled (depending on velocity thresholds). Switch from off to on state while in stand-still and at `IHOLD` = nominal `IRUN` current only. |              |
| 3   | `multistep_filt`          | 1           | Enable step input filtering for `stealthChop` optimization with external step source (default = 1)                                 |              |
| 4   | `shaft`                   | 1           | Inverse motor direction                                                                                                            |              |
| 5   | `diag0_error`             | 1           | Enable `DIAG0` active on driver errors: Over temperature (`ot`), short to GND (`s2g`), undervoltage chargepump (`uv_cp`). `DIAG0` always shows the reset-status, i.e. is active low during reset condition. |              |
| 6   | `diag0_otpw`              | 1           | Enable `DIAG0` active on driver over temperature prewarning (`otpw`)                                                               |              |
| 7   | `diag0_stall`             | 1           | Enable `DIAG0` active on motor stall (set `TCOOLTHRS` before using this feature)                                                   |              |
| 8   | `diag1_stall`             | 1           | Enable `DIAG1` active on motor stall (set `TCOOLTHRS` before using this feature)                                                   |              |
| 9   | `diag1_index`             | 1           | Enable `DIAG1` active on index position (microstep look up table position 0)                                                       |              |
| 10  | `diag1_onstate`           | 1           | Enable `DIAG1` active when chopper is on (for the coil which is in the second half of the fullstep)                                |              |
| 11  | `diag1_steps_skipped`     | 1           | Enable output toggle when steps are skipped in `dcStep` mode (increment of `LOST_STEPS`). Do not enable in conjunction with other `DIAG1` options. |              |
| 12  | `diag0_int_pushpull`      | 0           | `DIAG0` is open collector output (active low)                                                                                      |              |
|     |                           | 1           | Enable `DIAG0` push pull output (active high)                                                                                      |              |
| 13  | `diag1_pushpull`          | 0           | `DIAG1` is open collector output (active low)                                                                                      |              |
|     |                           | 1           | Enable `DIAG1` push pull output (active high)                                                                                      |              |
| 14  | `small_hysteresis`        | 0           | Hysteresis for step frequency comparison is 1/16                                                                                   |              |
|     |                           | 1           | Hysteresis for step frequency comparison is 1/32                                                                                   |              |
| 15  | `stop_enable`             | 0           | Normal operation                                                                                                                   |              |
|     |                           | 1           | Emergency stop: `ENCA_DCIN` stops the sequencer when tied high (no steps become executed by the sequencer, motor goes to standstill state). |              |
| 16  | `direct_mode`             | 0           | Normal operation                                                                                                                   |              |
|     |                           | 1           | Motor coil currents and polarity directly programmed via serial interface: Register `XDIRECT` (0x2D) specifies signed coil A current (bits 8..0) and coil B current (bits 24..16). In this mode, the current is scaled by `IHOLD` setting. Velocity based current regulation of `stealthChop` is not available in this mode. The automatic `stealthChop` current regulation will work only for low stepper motor velocities. |              |
| 17  | `test_mode`               | 0           | Normal operation                                                                                                                   | Not for user, set to 0 for normal operation! |
|     |                           | 1           | Enable analog test output on pin `DCO`. `IHOLD[1..0]` selects the function of `DCO`: 0..2: T120, DAC, VDDH                        |              |

#### `GSTAT` (Global Status Flags, Addr: 0x01, R+WC)

| Bit | Field Name    | Value/Logic | Description                                                                                                   | Hint/Default |
|-----|---------------|-------------|---------------------------------------------------------------------------------------------------------------|--------------|
| 0   | `reset`       | 1           | Indicates that the IC has been reset. All registers have been cleared to reset values.                        | Re-Write with '1' bit to clear respective flags |
| 1   | `drv_err`     | 1           | Indicates that the driver has been shut down due to overtemperature or short circuit detection. Read `DRV_STATUS` for details. The flag can only be cleared when the temperature is below the limit again. |              |
| 2   | `uv_cp`       | 1           | Indicates an undervoltage on the charge pump. The driver is disabled during undervoltage. This flag is latched for information. |              |

#### `IOIN` (Input State, Addr: 0x04, R)

| Bit | Field Name   | Description                                 |
|-----|--------------|---------------------------------------------|
| 0   | `STEP`       | Reads the state of all input pins available  |
| 1   | `DIR`        | Direction input                             |
| 2   | `DCEN_CFG4`  | dcStep enable input                         |
| 3   | `DCIN_CFG5`  | dcStep gating input for axis synchronization|
| 4   | `DRV_ENN`    | Enable input                               |
| 5   | `DCO_CFG6`   | dcStep ready output                         |
| 6   | `1`          | Reserved                                   |
| 7   | `unused`     | Unused                                     |

#### `OTP_PROG` (OTP Programming, Addr: 0x06, W)

| Bit    | Field Name   | Description                                                                                 | Hint/Default |
|--------|--------------|---------------------------------------------------------------------------------------------|--------------|
| 2..0   | `OTPBIT`     | Selection of OTP bit to be programmed to the selected byte location (n=0..7: programs bit n to a logic 1) |              |
| 5..4   | `OTPBYTE`    | Set to 00                                                                                  |              |
| 15..8  | `OTPMAGIC`   | Set to 0xbd to enable programming. A programming time of minimum 10ms per bit is recommended (check by reading `OTP_READ`). |              |
| 31..24 | `VERSION`    | 0x30 = first version of the IC. Identical numbers mean full digital compatibility.          |              |

#### `OTP_READ` (OTP Memory Result, Addr: 0x07, R)

| Bit    | Field Name         | Description           |
|--------|--------------------|-----------------------|
| 7..0   | `OTP0 byte 0`      | OTP0 byte 0 read data |

#### `FACTORY_CONF` (Factory Configuration, Addr: 0x08, RW)

| Bit   | Field Name   | Description                      | Hint/Default |
|-------|--------------|----------------------------------|--------------|
| 4..0  | `FCLKTRIM`   | Lowest to highest clock frequency. 0..31: Check at charge pump output. The frequency span is not guaranteed, but it is tested that tuning to 12MHz internal clock is possible. Devices come preset to 12MHz clock frequency by OTP programming. | Reset Default: OTP |

#### `SHORT_CONF` (Short Detection, Addr: 0x09, W)

| Bit   | Field Name     | Value/Logic | Description                                 | Hint/Default |
|-------|----------------|-------------|---------------------------------------------|--------------|
| 3..0  | `S2VS_LEVEL`   | 4..15       | Short to VS detector level for lowside FETs. Checks for voltage drop in LS MOSFET and sense resistor. 4 = highest sensitivity, 15 = lowest sensitivity. | Settings from 1 to 3 will trigger during normal operation due to voltage drop on sense resistor. Reset Default: OTP 6 or 12 |
| 11..8 | `S2G_LEVEL`    | 2..15       | Short to GND detector level for highside FETs. Checks for voltage drop on high side MOSFET. 2 = highest sensitivity, 15 = lowest sensitivity. | Settings below 6 not recommended at >52V operation – false detection might result. Reset Default: OTP 6 or 12 |
| 17..16| `SHORTFILTER`  | 0..3        | Spike filtering bandwidth for short detection. 0 = lowest (100ns), 1 = 1μs, 2 = 2μs, 3 = 3μs. | A good PCB layout will allow using setting 0. Increase value if erroneous short detection occurs. Reset Default: %01 |
| 18    | `shortdelay`   | 0..1        | Short detection delay. 0 = 750ns: normal, 1 = 1500ns: high. The short detection delay shall cover the bridge switching time. 0 will work for most applications. | Reset Default: 0 |
